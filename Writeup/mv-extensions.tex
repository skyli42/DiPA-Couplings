
\section{Program Model Extensions}

The class of programs we have defined is rather limited, leading to the natural question of whether our results can be extended to more powerful program models. 

Some `natural' extensions of DiPA end up reducing directly to DiPA. For example, we considered an extension of DiPA that included a single integral ``counter'' variable $n$; this program model also allowed for branching conditional on $n$ being greater than a threshold value. 
We discovered that every DiPA equipped with a counter can be rewritten as a standard DiPA by using a power set-style automata construction. \sky{is more elaboration here necessary?}

However, there are other extensions that warrant further study. In particular, we analyze one extension of DiPA that allows for two real-valued program variables $\texttt{x}, \texttt{y}$.

\subsection{Multivariable Programs}

\subsubsection{Multivariable Transitions}

We begin by defining a multiple-variable transition, as in the single variable case. 

\begin{defn}[$k$-variable guards]
    Let $\texttt{x}_1, \ldots \texttt{x}_k$ be real-valued program variables. Then a \textbf{$k$-variable guard} is a boolean statement $c = c^{(\texttt{x}_1)}\oplus_1 c^{(\texttt{x}_2)}\oplus_2\ldots\oplus_{k-1}c^{(\texttt{x}_k)}$ where for all $i$, \begin{itemize}
        \item $c^{(\texttt{x}_i)}\in \{\texttt{true}, \mvlguard[\texttt{x}_i], \mvgguard[\texttt{x}_i]\}$
        \item $\oplus_i \in \{\land, \lor\}$
    \end{itemize}
    Without loss of generality, we will assume that every $k$-variable guard is in its most simplified form. 
    
    
    % For example, we will disallow any guards of the form $c = \ldots \texttt{true}\lor \lguard[\texttt{x}_i]\ldots$, since the guard would simplify to $\texttt{true}$ (in which case, we suppose that for all $i$, $c^{(\texttt{x}_i)} = \texttt{true}$ and $\oplus_i = \land$). 

    Let $\mathcal{C}^{(k)}$ be the set of all possible guards with $k$ variables $\texttt{x}_1, \ldots \texttt{x}_k$.
\end{defn}

\sky{the associativity details of the guard have to be fixed - can assume left-associative or allow for any possible groupings}

\begin{defn}[$k$-variable transitions]
    A $k$-variable transition ($k$v-transition) is a tuple $(c, \sigma, \tau)$ where \begin{itemize}
        \item $c\in\mathcal{C}^{(k)}$ is a transition guard.
        \item $\sigma\in\Gamma\cup\{\texttt{insample}^{(\texttt{x}_1)}, \ldots, \texttt{insample}^{(\texttt{x}_k)}, \texttt{insample}'\}$ is the output of the transition
        \item $\tau \in \{0\} \cup [k]$ indicates whether to assign $\texttt{insample}^{(\texttt{x}_\tau)}$ into no variable (when $\tau = 0$) or $\texttt{x}_\tau$. In particular, note that only a single variable can be assigned into at a time and that every variable can only take its ``corresponding'' $\texttt{insample}$ value. 
    \end{itemize}
    \sky{I can never remember if $[n]$ notation includes 0 but I'm assuming it does here}
\end{defn}

As with single variable transitions, we associate every transition $t$ with two real-valued noise parameters $P(t) = (d, d')$

\subsubsection{$k$-Variable Program Semantics}

$k$-variable transitions semantically operate extremely similarly to single variable transitions: given some threshold values $\texttt{x}_i$ and a transition $t = (c, \sigma, \tau)$, let $P(t) = (d, d')$. Then $t$ will first read in a real number input $\texttt{in}$, 
sample $k$ \textbf{independent} random variables $z^{(\texttt{x}_1)}\sim\Lap(0, \frac{1}{d\varepsilon}),\ldots, z^{(\texttt{x}_k)}\sim\Lap(0, \frac{1}{d\varepsilon})$ for comparing a noised version of the input to each threshold variable as well as one random variable $z' \sim\Lap(0, \frac{1}{d\varepsilon})$ to potentially be used for outputting a re-noised version of the input. 

Using these noise variables, the transition then assigns $k$ variables $\texttt{insample}^{(\texttt{x}_i)} = \texttt{in} + z^{(x)}$ and an additional variable $\texttt{insample}' = \texttt{in} + z'$. 
If the guard $c$ is satisfied when comparing $\texttt{insample}^{(\texttt{x}_i)}$ to $\texttt{x}_i$ for all $i$, then the transition outputs $\sigma$ and, if $\tau\neq 0$, reassigns $\texttt{x}_{\tau} = \texttt{insample}^{(\texttt{x}_\tau)}$.

More formally, a program state is a tuple consisting of values for every threshold variable $\texttt{x}_i$ and an output value. Let $S = dist(\RR^k\times (\Gamma\cup \RR)^*)$ be the set of distributions over all possible program states. As expected, every possible input is simply an element of $\RR$. 

Then the semantics of a $k$v-transition $t$ can be defined as a function $\Phi_t: dist_\downarrow(S)\times \RR\to dist_\downarrow(S)$ that maps an initial program state and an input to a distribution of subsequent program states.

The precise semantics are defined exactly analogously to the single variable case. 

We again denote the probability that a transition $t=(c, \sigma, \tau)$ outputs a specific measurable output event $o$ as $\PP[\vec{\texttt{x}}, t, \texttt{in}, o]$, where $\vec{\texttt{x}}\in \RR^k$ is a vector of initial values of all threshold values $\texttt{x}_i$, $\texttt{in}\in \RR$ is a real-valued input, and $o\subseteq \Gamma\cup\RR$ is a possible measurable output event of $t$.

Specifically, if $\vec{\texttt{x}}$ is a distribution over $\RR^k$ and $o$ is a measurable output event of $t$, then $\PP[\vec{\texttt{x}}, t, \texttt{in}, o]$ is the marginal of $\Phi_t((\vec{\texttt{x}}, \lambda), \texttt{in})$ on $(\cdot, o)$

\sky{remove later}
\begin{defn}[Valid Transition Alphabets]
    A finite 2v-transition alphabet $\Sigma_T$ is valid if it satisfies the following conditions: 
    \begin{itemize}
        \item \textbf{Initialization:} There exist some $t_{init}^{(x)}, t_{init}^{(y)}\in \Sigma_T$ such that $t_{init}^{(x)} = (q_0, q_1, \texttt{true}, \sigma_0, 1)$ and $t_{init}^{(y)} = (q_1, q_2, \texttt{true}, \sigma_1, 2)$ for some $q_0, q_1, q_2\in Q$, $\sigma_0, \sigma_1 \in \Gamma\cup\{\texttt{insample}, \texttt{insample}'\}$. 
        \item \textbf{Determinism}: If $\Sigma_T$ contains transition $t, t'$ such that $t=(q, q', c, \sigma, \tau)$ and $t'= (q, q^*, c', \sigma', \tau')$, then $c$ and $c'$ must be logically disjoint. 
        \item \textbf{Output distinction}: If there exist some $\sigma, \sigma', \tau, \tau'$ such that $(q, q', c, \sigma, \tau)\in \Sigma_T$  and $(q, q^*, c', \sigma', \tau') \in \Sigma_T$ for distinct guards $c, c'$, then $\sigma \neq \sigma'$. Additionally, at least one of $\sigma\in \Gamma$, $\sigma'\in \Gamma$ is true.
        \item \textbf{Non-input location condition}: For all locations $q\in Q_{non}$, if there exists a transition $t=(q, q', c, \sigma, \tau)$ such that $t\in \Sigma_T$, then $c = \texttt{true}$.
        \item \textbf{Assignment spread parameter condition}: There exists some constant $d_{at}>0$ such that for all transitions $t = (q, q', c, \sigma, \tau)\in \Sigma_T$ where $\tau \in \{1, 2\}$, $P(q) = (d_{at}, d_q')$.
    \end{itemize}
\end{defn}

For technical reasons that will become clear later, we introduce a new validity condition (the ``assignment spread parameter condition'') that requires that all assignment transitions have the same spread parameter on their Laplace noise.

\subsubsection{Multivariable Couplings}

In this section, we introduce two methods for constructing two variable couplings for $k$v-transitions; one method combines couplings in parallel and the other combines couplings for different variables together. 

We begin by showing that if we can create couplings for each variable in isolation, then we can immediately create a coupling for a combined $k$v-transition. 

First, we define what it means to isolate a variable in a transition: 

\begin{defn}[Isolating a variable]
    Let $t = (c, \sigma, \tau)$ be a $k$-variable transition. For all $i$, $t^{(\texttt{x}_i)}$ is the single variable transition $t^{(\texttt{x}_i)} = (c^{(\texttt{x}_i)}, \sigma^{(\texttt{x}_i)}, \tau^{(\texttt{x}_i)})$, where $c^{(\texttt{x}_i)}$ is the $\texttt{x}_i$-component of $c$ as defined above, $\sigma^{(\texttt{x}_i)} = \begin{cases}
        \sigma & \sigma \in \Gamma\\
        \sigma & \sigma = \texttt{insample}^{(\texttt{x}_i)}\\
        \bot & \text{otherwise}
    \end{cases}$ and $\tau^{(\texttt{x}_i)} = \begin{cases}
        \texttt{true} & \tau = i\\
        \texttt{false} & \tau \neq i
    \end{cases}$, where $\bot$ is a unique ``junk'' symbol. We call $t^{(\texttt{x}_i)}$ the $\texttt{x}_i$-\textbf{isolated} version of $t$. 
\end{defn}

By lemma \ref{simplifiedIndTransitionCoupling}, we know that, given a $k$v-transition $t$, we can create couplings for each $\texttt{x}_i$-isolated version of $t$. We demonstrate that this is sufficient to create couplings for $t$ as a whole. 

\begin{lemma}\label{simplifiedMvParallelCouplingsLemma}
    For all $\varepsilon>0$, for any $k$v-transition $t$, measurable output event $\sigma$ of $t$, and adjacent inputs $\texttt{in}\brangle{1}\sim\texttt{in}\brangle{2}$, if we are given $2k+1$ real number ``shifts'' $\gamma_{x_1}, \ldots, \gamma_{x_k}, \gamma_t^{(x_1)}, \ldots, \gamma_t^{(x_k)}, \gamma_t'$ such that for all $1\leq i\leq k$, \[
        \begin{cases}
            \gamma_t^{(x_i)}\leq\gamma_{x_i} & c = \lguard[\texttt{x}_i]\\
            \gamma_t^{(x_i)}\geq\gamma_{x_i} & c = \gguard[\texttt{x}_i]\\
            \gamma_t^{(x_i)}=0 & \sigma = \texttt{insample}^{(\texttt{x}_i)}\\
            \gamma_t'=0 & \sigma = \texttt{insample}'
      \end{cases},
      \]
      then we can construct an approximate lifting that proves $\PP[\vec{X}\brangle{1}, t, \texttt{in}\brangle{1}, \sigma]\leq e^{d\varepsilon}\PP[\vec{X}\brangle{2}, t, \texttt{in}\brangle{2}, \sigma]$ for some bounded $d>0$ and initial threshold Laplace-distributed variables $\vec{X}\brangle{1}$, $\vec{X}\brangle{2}$. 
\end{lemma}


\sky{the more technical version}
\begin{lemma}\label{mvParallelCouplingsLemma}
    Let $\vec{X}\brangle{1} = (X_1\brangle{1}, \ldots X_k\brangle{1})$ where $X_i\brangle{1}\sim \Lap(\mu_{x_i}\brangle{1}, \frac{1}{d_{x_i}\varepsilon})$ are independent random variables and $\vec{X}\brangle{2} = (X_1\brangle{2}, \ldots X_k\brangle{2})$ where $X_i\brangle{2}\sim \Lap(\mu_{x_i}\brangle{2}, \frac{1}{d_{x_i}\varepsilon})$ are independent random variables be representations of two possible initial values of $\vec{X}$, respectively.

    Let $t = (c, \sigma, \tau)$ be a $k$v-transition such that $P(t) = (d_t, d_t')$.

    Let $\texttt{in}\brangle{1}\sim\texttt{in}\brangle{2}$ be an arbitrary adjacent input pair and let $o\brangle{1}$, $o\brangle{2}$ be random variables representing possible outputs of $t$ given inputs $\texttt{in}\brangle{1}$ and $\texttt{in}\brangle{2}$, respectively. 

    Then $\forall \varepsilon>0$ and for all $\gamma_{x_1}, \ldots, \gamma_{x_k}, \gamma_t^{(x_1)}, \ldots, \gamma_t^{(x_k)}, \gamma_t'$ that satisfy the constraints \[
        \begin{cases}
            \gamma_t^{(x_i)}\leq\gamma_{x_i} & c = \lguard[\texttt{x}_i]\\
            \gamma_t^{(x_i)}\geq\gamma_{x_i} & c = \gguard[\texttt{x}_i]\\
            \gamma_t^{(x_i)}=0 & \sigma = \texttt{insample}^{(\texttt{x}_i)}\\
            \gamma_t'=0 & \sigma = \texttt{insample}'
      \end{cases}
      \] for all $1\leq i\leq k$, the lifting $o\brangle{1}\{(a, b): a=\sigma\implies b=\sigma\}^{\#d\varepsilon}o\brangle{2}$ is valid for 
      $d = \sum_{i=1}^k\left(|\mu_{x_i}\brangle{1}-\mu_{x_i}\brangle{2}+\gamma_{x_i}|d_{x_i}+|\texttt{in}\brangle{1}-\texttt{in}\brangle{2}+\gamma_t^{(x_i)}|d_t\right)+|\texttt{in}\brangle{1}-\texttt{in}\brangle{2}+\gamma_t'|d_t'$.
\end{lemma}
\begin{proof}
    From lemma \ref{indTransitionCoupling}, we know that if these constraints are satisfied, we can create liftings such that for all $i$, $c^{(\texttt{x}_i)}$ is satisfied in run $\brangle{1}\implies c^{(\texttt{x}_i)}$ is satisfied in run $\brangle{2}$.
    
    Because $c$ is made of conjunctions and disjunctions of all $c^{(\texttt{x})_i}$, by [basic logical rules]\sky{is more specificity needed?}, this means that if $c$ is satisfied in run $\brangle{1}$, then $c$ must also be satisfied in $\brangle{2}$. 

    Finally, as before, if $\sigma \in \{\texttt{insample}^{(x_1)}\ldots \texttt{insample}^{(x_k)},\texttt{insample}'\}$, then for all $\sigma$, $o\brangle{1}=\sigma \implies o\brangle{2} = \sigma$. Further, note that we only need to couple $\texttt{insample}'\brangle{1}$ and $\texttt{insample}'\brangle{2}$ once for all variables. By simply adding up the costs from lemma \ref{indTransitionCoupling}, we complete the proof.
\end{proof}

This provides an extremely straightforward method of combining coupling strategies for different variables together; indeed, this specific result is immediately extensible to an arbitrary number of variables. 

As in the single variable case, we call a collection of shifts $\gamma_{x_1}, \ldots, \gamma_{x_k}, \gamma_t^{(x_1)}, \ldots, \gamma_t^{(x_k)}, \gamma_t'$ as a coupling strategy, which is valid if it satisfies the above constraints. 

\sky{this might be redundant}
\begin{cor}
    For a $k$v-transition $t$, if, for all $1\leq i\leq k$, there exists a coupling strategy $C_i$ such that $C_i$ is a valid coupling strategy for the isolated transition $t^{(x_i)}$, then there exists a valid coupling strategy $C$ for $t$ such that $cost(C)\leq \sum_{i=1}^k cost(C_i)$.
\end{cor}


\subsubsection{Notes on $k$-variable cross couplings}
\begin{lemma}
    For any two adjacent initial variable distributions $\vec{X}\brangle{1}\sim \vec{X}\brangle{2}$ and a transition $t = (c, \sigma, \tau)$, if the boolean expression produced by setting all $\texttt{insample}$ variables to be equal to each other and every $\texttt{x}_i$ to be equal to the mean of the distribution $X_i\brangle{1}$ evaluates to a tautology or a contradiction,
    then we can construct an approximate lifting that proves $\PP[\vec{X}\brangle{1}, t, \texttt{in}\brangle{1}, \sigma]\leq e^{d\varepsilon}\PP[\vec{X}\brangle{2}, t, \texttt{in}\brangle{2}, \sigma]$ for some constant $d>0$. 
\end{lemma}


\textbf{Cross-Couplings}

We now introduce a new type of coupling strategy for a single (2v-)transition:

\begin{lemma}\label{mvIndTransitionCoupling}
    Let $X\brangle{1}\sim \Lap(\mu_x\brangle{1}, \frac{1}{d_{at}\varepsilon}), X\brangle{2}\sim\Lap(\mu_x\brangle{2}, \frac{1}{d_{at}\varepsilon})$ respectively be random variables representing two possible initial values of $\texttt{x}$, 
    and $Y\brangle{1}\sim \Lap(\mu_y\brangle{1}, \frac{1}{d_{at}\varepsilon}), Y\brangle{2}\sim\Lap(\mu_y\brangle{2}, \frac{1}{d_{at}\varepsilon})$ respectively be random variables representing two possible initial values of $\texttt{y}$. 

    Let $t\in \Sigma_T$ be a (2v-)transition $t = (q, q^*, c, \sigma, \tau)$ from $q$ to $q^*\in Q$. Let $P(q) = (d_q, d_q')$.

    Let $\texttt{in}\brangle{1}, \texttt{in}\brangle{2}$ be an arbitrary valid adjacent input pair for $t$ and let $o\brangle{1}$, $o\brangle{2}$ be random variables representing possible outputs of $t$ given inputs $\texttt{in}\brangle{1}$ and $\texttt{in}\brangle{2}$, respectively. 

    Then for all $\gamma_T^{(x)}, \gamma_q^{(x)}, \gamma_q^{(x)\prime},\gamma_T^{(y)}, \gamma_q^{(y)}, \gamma_q^{(y)\prime} \in [-1, 1]$ that satisfy the constraints \[
        \begin{cases}
          \gamma_q^{(x)}=0 & \sigma = \texttt{insample}^{(x)}\\
          \gamma_q^{(x)\prime}=0 & \sigma = \texttt{insample}^{(x)\prime}\\
          \gamma_q^{(y)}=0 & \sigma = \texttt{insample}^{(y)}\\
          \gamma_q^{(y)\prime}=0 & \sigma = \texttt{insample}^{(y)\prime}
        \end{cases},
      \]

    The following four statements hold:\begin{enumerate}
        \item If $c = \lguard[\texttt{x}] \land \gguard[\texttt{y}]$, then $\forall \varepsilon>0$, the lifting $o\brangle{1}\{(a, b): a=\sigma\implies b=\sigma\}^{\#d\varepsilon}o\brangle{2}$ is valid for $d = |\min(\mu_y\brangle{1}-\mu_x\brangle{1}, 0)|+(|\mu\brangle{1}-\mu\brangle{2}+\gamma_x|)d_{at}+(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q|)d_q+(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q'|)d_q'$. 
        \item If $c = \gguard[\texttt{x}] \land \lguard[\texttt{y}]$, then $\forall \varepsilon>0$, the lifting $o\brangle{1}\{(a, b): a=\sigma\implies b=\sigma\}^{\#d\varepsilon}o\brangle{2}$ is valid for $d = |\min(\mu_x\brangle{1}-\mu_y\brangle{1}, 0)|+(|\mu\brangle{1}-\mu\brangle{2}+\gamma_x|)d_{at}+(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q|)d_q+(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q'|)d_q'$. 
        \item If $c = \lguard[\texttt{x}] \lor \gguard[\texttt{y}]$, then $\forall \varepsilon>0$, the lifting $o\brangle{1}\{(a, b): a=\sigma\implies b=\sigma\}^{\#d\varepsilon}o\brangle{2}$ is valid for $d = |\max(0, \mu_y\brangle{1}+ \gamma_T^{(y)}-\mu_x\brangle{1}-\gamma_T^{(x)})|+(|\mu\brangle{1}-\mu\brangle{2}+\gamma_x|)d_{at}+(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q|)d_q+(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q'|)d_q'$. 
        \item If $c = \gguard[\texttt{x}] \lor \lguard[\texttt{y}]$, then $\forall \varepsilon>0$, the lifting $o\brangle{1}\{(a, b): a=\sigma\implies b=\sigma\}^{\#d\varepsilon}o\brangle{2}$ is valid for $d = |\max(0, \mu_x\brangle{1}+ \gamma_T^{(x)}-\mu_y\brangle{1}-\gamma_T^{(y)})|+(|\mu\brangle{1}-\mu\brangle{2}+\gamma_x|)d_{at}+(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q|)d_q+(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q'|)d_q'$. 
    \end{enumerate}
\end{lemma}
\begin{proof}
    For convenience, we will rewrite $X$ and $Y$ as $X = \mu_x + \zeta_x$ and $Y = \mu_y + \zeta_y$, where $\zeta_x \sim\Lap(0, \frac{1}{d_{at}\varepsilon})$ and $\zeta_y \sim\Lap(0, \frac{1}{d_{at}\varepsilon})$. 
    As before, we also write $\texttt{insample}^{(x)} = \texttt{in} + z^{(x)}$, where $z\sim\Lap(0, \frac{1}{d_q\varepsilon})$ and $\texttt{insample}^{(x)\prime} = \texttt{in} + z^{(x)\prime}$, where $z'\sim\Lap(0, \frac{1}{d_q'\varepsilon})$ (and symmetrically for $\texttt{insample}^{(y)}$, $\texttt{insample}^{(y)\prime}$).

    We show cases (1) and (3). Cases (2) and (4) follow symmetrically. 

    As in the single variable case, suppose that we have the liftings
    \begin{itemize}
        \item $X\brangle{1}+\gamma_T^{(x)} (=)^{\#(|\mu_x\brangle{1}-\mu_x\brangle{2}+\gamma_T^{(x)}|)d_x\varepsilon}X\brangle{2}$.
        \item $\texttt{insample}^{(x)}\brangle{1} +\gamma_q^{(x)}{(=)}^{\#(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q^{(x)}|)d_q\varepsilon}\texttt{insample}^{(x)}\brangle{2}$
        \item $\texttt{insample}^{(x)\prime}\brangle{1} +\gamma_q^{(x)\prime}{(=)}^{\#(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q^{(x)\prime}|)d_q'\varepsilon}\texttt{insample}^{(x)\prime}\brangle{2}$
        \item $Y\brangle{1}+\gamma_T^{(y)} (=)^{\#(|\mu_y\brangle{1}-\mu_y\brangle{2}+\gamma_T^{(y)}|)d_y\varepsilon}Y\brangle{2}$.
        \item $\texttt{insample}^{(y)}\brangle{1} +\gamma_q^{(y)}{(=)}^{\#(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q^{(y)}|)d_q\varepsilon}\texttt{insample}^{(y)}\brangle{2}$
        \item $\texttt{insample}^{(y)\prime}\brangle{1} +\gamma_q^{(y)\prime}{(=)}^{\#(|-\texttt{in}\brangle{1}+\texttt{in}\brangle{2}-\gamma_q^{(y)\prime}|)d_q'\varepsilon}\texttt{insample}^{(y)\prime}\brangle{2}$
    \end{itemize}

    \textbf{Case 1:}

    Create the lifting $\zeta_x\brangle{1} +\gamma_{xy}(=)^{\#|\gamma_{xy}|d_{at}\varepsilon}\zeta_y\brangle{1}$ where $\gamma_{xy} = -\min(\mu_y\brangle{1}-\mu_x\brangle{1}, 0)$. 

    Then observe that if $\mu_x\brangle{1}\geq \mu_y\brangle{1}$, \begin{align*}
        X\brangle{1}&= \mu_x\brangle{1} + \zeta_x\brangle{1}\\
        &= \mu_x\brangle{1} + \zeta_y\brangle{1}+\mu_y\brangle{1}-\mu-x\brangle{1}\\
        &=Y\brangle{1}
    \end{align*}

    Otherwise, if $\mu_x\brangle{1}<\mu_y\brangle{1}$, then \begin{align*}
        X\brangle{1}&= \mu_x\brangle{1} + \zeta_x\brangle{1}\\
        &\leq \mu_y\brangle{1}+\zeta_y\brangle{1}\\
        &=Y\brangle{1}
    \end{align*}
    so $X\brangle{1}\leq Y\brangle{1}$.

    Further, create the lifting $z^{(x)}\brangle{1}(=)^{\#0}z^{(y)}\brangle{1}$. Note that then $\texttt{insample}^{(x)}\brangle{1}=\texttt{in}_i\brangle{1} + z_i^{(x)}\brangle{1} =\texttt{in}_i\brangle{1} + z_i^{(y)}\brangle{1}=\texttt{insample}^{(y)}\brangle{1}$.

    Then because $x\brangle{1} \leq y\brangle{1}$, $\texttt{insample}^{(x)}\brangle{1}<x\brangle{1}\land\texttt{insample}^{(y)}\brangle{1}\geq y\brangle{1}$ must be false. Thus, $\texttt{insample}^{(x)}\brangle{1}<x\brangle{1}\land\texttt{insample}^{(y)}\brangle{1}\geq y\brangle{1}\implies \texttt{insample}^{(x)}<x\brangle{2}\land\texttt{insample}^{(y)}\geq y\brangle{2}$.

    This suffices to show that if the transition is taken in run $\brangle{1}$, then it is also taken in run $\brangle{2}$. Thus, if any of \begin{itemize}
        \item $\sigma \in \Gamma$
        \item $\sigma = \texttt{insample}^{(x)}$ and $\gamma_q^{(x)}=0$ 
        \item $\sigma = \texttt{insample}^{(x)\prime}$ and $\gamma_q^{(x)\prime}=0$ 
        \item $\sigma = \texttt{insample}^{(y)}$ and $\gamma_q^{(y)}=0$
        \item $\sigma = \texttt{insample}^{(y)\prime}$ and $\gamma_q^{(y)\prime}=0$
    \end{itemize}
    are true, then the lifting holds as desired. 

    \textbf{Case 3:}
    
    Create the lifting $\zeta_x\brangle{1} + \gamma_{xy} (=)^{\#|\gamma_{xy}|d_{at}\varepsilon} \zeta_y\brangle{1}$ where $\gamma_{xy} = -\max(0, \mu_y\brangle{1}+ \gamma_T^{(y)}-\mu_x\brangle{1}-\gamma_T^{(x)})$

    Then if $\mu_x\brangle{1}+\gamma_T^{(x)}\leq \mu_y\brangle{1}+\gamma_T^{(y)}$, \begin{align*}
        X\brangle{2} &= X\brangle{1} + \gamma_T^{(x)}\\
        &=\mu_x\brangle{1} + \zeta_x\brangle{1} + \gamma_T^{(x)}\\
        &=\mu_x\brangle{1} +\zeta_y\brangle{1} + \mu_y\brangle{1}+ \gamma_T^{(y)}-\mu_x\brangle{1}-\gamma_T^{(x)} +\gamma_T^{(x)}\\
        &=Y\brangle{1} + \gamma_T^{(y)}\\
        &= Y\brangle{2}
    \end{align*}

    Otherwise, if $\mu_x\brangle{1}+\gamma_T^{(x)}> \mu_y\brangle{1}+\gamma_T^{(y)}$, then \begin{align*}
        X\brangle{2} &= X\brangle{1} + \gamma_T^{(x)}\\
        &=\mu_x\brangle{1} + \zeta_x\brangle{1} + \gamma_T^{(x)}\\
        &\geq \mu_y\brangle{1} +\gamma_T^{(y)}+\zeta_y\brangle{1}\\
        &=Y\brangle{1} + \gamma_T^{(y)}\\
        &= Y\brangle{2}
    \end{align*}

    Thus, $X\brangle{2}\geq Y\brangle{2}$.

    Further, create the lifting $z^{(x)}\brangle{2}(=)^{\#0}z^{(y)}\brangle{2}$. Note that then $\texttt{insample}^{(x)}\brangle{2}=\texttt{in}_i\brangle{2} + z_i^{(x)}\brangle{2} =\texttt{in}_i\brangle{2} + z_i^{(y)}\brangle{2}=\texttt{insample}^{(y)}\brangle{2}$.

    Then because $X\brangle{2} \geq Y\brangle{2}$, $\texttt{insample}^{(x)}\brangle{2}<x\brangle{2}\lor \texttt{insample}^{(y)}\brangle{2}\geq y\brangle{2}$ must be true. Thus, $\texttt{insample}^{(x)}\brangle{1}<x\brangle{1}\lor\texttt{insample}^{(y)}\brangle{1}\geq y\brangle{1}\implies \texttt{insample}^{(x)}<x\brangle{2}\lor\texttt{insample}^{(y)}\geq y\brangle{2}$.

    As before, if any of \begin{itemize}
        \item $\sigma \in \Gamma$
        \item $\sigma = \texttt{insample}^{(x)}$ and $\gamma_q^{(x)}=0$ 
        \item $\sigma = \texttt{insample}^{(x)\prime}$ and $\gamma_q^{(x)\prime}=0$ 
        \item $\sigma = \texttt{insample}^{(y)}$ and $\gamma_q^{(y)}=0$
        \item $\sigma = \texttt{insample}^{(y)\prime}$ and $\gamma_q^{(y)\prime}=0$
    \end{itemize}
    are true, then the lifting holds as desired. 

\end{proof}

Depending on the initial threshold values, this allows us to construct liftings for certain transitions ``for free'' in a manner compatible with existing liftings. In particular, this construction applies to transitions whose guards intuitively correspond to checking if an input is within either the empty set or the entire real line, which are either always true or always false. 

\begin{defn}
    Let $\Sigma_T$ be a valid 2v-transition alphabet. A 2v-path over $\Sigma_T$ is a sequence of transitions $\rho=t_0\cdot t_1\cdot \ldots \cdot t_{n-1}$ such that for all $i$ there exists a location $q_i\in Q$ such that $t_i = (q_i, q_{i+1}, c_i, \sigma_i, \tau_i)$. A 2v-path is \textbf{complete} if it is in the form $t_{init}^{(x)}t_{init}^{(y)}\cdot \rho$ for some $\rho\in \Sigma_T^*$.
\end{defn}

The semantics of a 2v-path are again defined exactly analogously to the single variable case; we denote the probability of a path $\rho$ ``succeeding'' as $\PP[\texttt{x}, \texttt{y}, \rho, \texttt{in}, \sigma]$ for initial values $\texttt{x}, \texttt{y}\in \RR$, input sequence $\texttt{in}$ and output sequence $\sigma$. 

\sky{redefine privacy?}

We will allow cross-couplings only between assignment transitions of different variables; to avoid redundancy, we require that a cross-coupling is \textit{from} an assignment into $\texttt{x}$ and \textit{to} an assignment into $\texttt{y}$.

Combining our ``parallel'' and ``cross'' coupling strategies gives us the major lemma for multivariable path couplings.

\begin{lemma}\label{mvcouplinglemma}
    Let $\rho = q_0\to \ldots \to q_n$ be a complete path of length $n$. 
    Let $\texttt{in}\brangle{1}\sim \texttt{in}\brangle{2}$ be arbitrary adjacent valid input sequences of length $n$. Additionally, fix some potential output $\sigma$ of $\rho$ of length $n$ and let $\sigma\brangle{1}$, $\sigma\brangle{2}$ be random variables representing possible outputs of $\rho$ given inputs $\texttt{in}\brangle{1}$ and $\texttt{in}\brangle{2}$, respectively. Additionally, for all $q_i$, let $P(q_i) = (d_i, d_i')$.

    Then $\forall \varepsilon>0$ and for all $\{\gamma_i, \gamma_i'\}_{i=0}^{n-1}$ that, for all $i$, satisfy the following constraints:\begin{enumerate}
        \item If $c_i(x) = \lguard[\texttt{x}]$, then at least one of the following is true: \begin{itemize}
            \item $\gamma_i^{(x)}\leq \gamma^{(x)}_{at_x(i)}$
            \item $c_i = \lguard[\texttt{x}]\lor\gguard[\texttt{y}]$ and $\gamma_{(at_x(i), at_y(i))} = -\min(\texttt{in}_{at_y(i)}\brangle{1}-\texttt{in}_{at_x(i)}\brangle{1}, 0)$
            \item $c_i = \lguard[\texttt{x}]\land\gguard[\texttt{y}]$ and $\gamma_{(at_x(i), at_y(i))} = -\max(0, \texttt{in}_{at_y(i)}\brangle{1}+ \gamma_{at_y(i)}^{(y)}-\texttt{in}_{at_x(i)}\brangle{1}-\gamma_{at_x(i)}^{(x)})$
        \end{itemize}
        \item If $c_i(x) = \gguard[\texttt{x}]$, then at least one of the following is true: \begin{itemize}
            \item $\gamma_i^{(x)}\geq \gamma^{(x)}_{at_x(i)}$
            \item $c_i = \gguard[\texttt{x}]\lor\lguard[\texttt{y}]$ and $\gamma_{(at_x(i), at_y(i))} = -\min(\texttt{in}_{at_x(i)}\brangle{1}-\texttt{in}_{at_y(i)}\brangle{1}, 0)$
            \item $c_i = \gguard[\texttt{x}]\land\lguard[\texttt{y}]$ and $\gamma_{(at_x(i), at_y(i))} = -\max(0, \texttt{in}_{at_x(i)}\brangle{1}+ \gamma_{at_x(i)}^{(x)}-\texttt{in}_{at_y(i)}\brangle{1}-\gamma_{at_y(i)}^{(y)})$
        \end{itemize}
        \item If $c_i(y) = \lguard[\texttt{y}]$, then at least one of the following is true: \begin{itemize}
            \item $\gamma_i^{(y)}\leq \gamma^{(y)}_{at_y(i)}$
            \item $c_i = \gguard[\texttt{x}]\lor\lguard[\texttt{y}]$ and $\gamma_{(at_x(i), at_y(i))} = -\min(\texttt{in}_{at_x(i)}\brangle{1}-\texttt{in}_{at_y(i)}\brangle{1}, 0)$
            \item $c_i = \gguard[\texttt{x}]\land\lguard[\texttt{y}]$ and $\gamma_{(at_x(i), at_y(i))} = -\max(0, \texttt{in}_{at_x(i)}\brangle{1}+ \gamma_{at_x(i)}^{(x)}-\texttt{in}_{at_y(i)}\brangle{1}-\gamma_{at_y(i)}^{(y)})$
        \end{itemize}
        \item If $c_i(y) = \gguard[\texttt{y}]$, then at least one of the following is true: \begin{itemize}
            \item $\gamma_i^{(x)}\geq \gamma^{(x)}_{at_x(i)}$
            \item $c_i = \lguard[\texttt{x}]\lor\gguard[\texttt{y}]$ and $\gamma_{(at_x(i), at_y(i))} = -\min(\texttt{in}_{at_y(i)}\brangle{1}-\texttt{in}_{at_x(i)}\brangle{1}, 0)$
            \item $c_i = \lguard[\texttt{x}]\land\gguard[\texttt{y}]$ and $\gamma_{(at_x(i), at_y(i))} = -\max(0, \texttt{in}_{at_y(i)}\brangle{1}+ \gamma_{at_y(i)}^{(y)}-\texttt{in}_{at_x(i)}\brangle{1}-\gamma_{at_x(i)}^{(x)})$
        \end{itemize}
        \item If $\sigma_i = \texttt{insample}^{(x)}$, then $\gamma_i^{(x)}=0$
        \item If $\sigma_i = \texttt{insample}^{(x)\prime}$, then $\gamma_i^{(x)\prime}=0$
        \item If $\sigma_i = \texttt{insample}^{(y)}$, then $\gamma_i^{(y)}=0$
        \item If $\sigma_i = \texttt{insample}^{(y)\prime}$, then $\gamma_i^{(y)\prime}=0$
    \end{enumerate}
      the lifting $\sigma\brangle{1}\{(a, b): a=\sigma\implies b=\sigma\}^{\#d\varepsilon}\sigma\brangle{2}$ is valid for $d = \sum_{i=0}^{n-1}(|-\texttt{in}_i\brangle{1}+\texttt{in}_i\brangle{2}-\gamma_i|)d_i+(|-\texttt{in}_i\brangle{1}+\texttt{in}_i\brangle{2}-\gamma_i'|)d_i' + \sum_{i_x, i_y}|\gamma_{(i_x, i_y)}|d_{at}$, and therefore $t$ is $d\varepsilon$-differentially private. 
\end{lemma}
\begin{proof}
    Follows from lemma \ref{mvIndTransitionCoupling} exactly as lemma \ref{multTransitionsCouplingProof} follows from lemma \ref{indTransitionCoupling}.
\end{proof}

This leads to a natural definition of two variable coupling strategies for paths:

\begin{defn}[Two Variable Coupling Strategies]
    A (2v)-coupling strategy for a 2v-path $\rho$ is a collection of shifts $(\gamma^{(x)}, \gamma^{(x)\prime}, \gamma^{(y)}, \gamma^{(y)\prime}, \gamma_{(i, j)})$ such that \begin{itemize}
        \item $\gamma^{(x)}, \gamma^{(x)\prime}, \gamma^{(y)}$, and $\gamma^{(y)\prime}$ are functions of a transition $t_i$ in $\rho$ as well as two adjacent inputs $\texttt{in}_i\brangle{1}$ and $\texttt{in}_i\brangle{2}$ that output a shift in the range [-1, 1]. 
        \item $\gamma_{(i, j)}$ is a function of an $\texttt{x}$-assignment transition $t_i$ and a $\texttt{y}$-assignment transition $t_j$ as well as the inputs $\texttt{in}_{i}\brangle{1}$ and $\texttt{in}_j\brangle{1}$ that outputs a real-valued shift. 
        \item In particular, we require that $\gamma_{(i, j)}(\texttt{in}_{i}\brangle{1},\texttt{in}_{j}\brangle{1}) \in \{-\min(\texttt{in}_{j}\brangle{1}-\texttt{in}_{i}\brangle{1}, 0),-\max(0, \texttt{in}_{j}\brangle{1}+ \gamma_{j}^{(y)}-\texttt{in}_{i}\brangle{1}-\gamma_{i}^{(x)}), -\min(\texttt{in}_{i}\brangle{1}-\texttt{in}_{j}\brangle{1}, 0), -\max(0, \texttt{in}_{i}\brangle{1}+ \gamma_{i}^{(x)}-\texttt{in}_{j}\brangle{1}-\gamma_{j}^{(y)})\}$
    \end{itemize}
\end{defn}

The extension of 2v-paths to looping branches and programs is natural and follows exactly the same structure as single variable programs. 

\sky{need to reintroduce graph here}

\begin{defn}[Two Variable Looping Branches]
    A 2v-looping branch is a looping branch (i.e. a language of complete paths that can be represented by a union-free regular expression) over a valid 2v-transition alphabet $\Sigma_T$.
\end{defn}

Just as with the single variable, a single constraint system can fully capture privacy for two variable programs.

We can also similarly define coupling strategies for looping branches:

\begin{defn}
    Let $r$ be the union-free regular expression describing paths in a looping branch $L$. Let $T_r$ be the set of all transitions that appear in $r$. Then a coupling strategy $C = (\gamma, \gamma', \gamma_{xy})$ for a looping branch is a function $C:T_r\times\RR \times\RR\to [-1, 1]\times[-1, 1]$ that computes shifts for each transition in $L$ as a function of two adjacent inputs.
\end{defn}

\begin{defn}\label{mvPrivacyConstraintSystem}
    Let $L$ be a 2v-looping branch over a valid transition alphabet $\Sigma_T$. If, for a coupling strategy $C_L = (\gamma, \gamma', \gamma_{(i, j)})$ for $L$, the constraints from lemma \ref{mvcouplinglemma} and the following constraints are satisfied for all possible inputs $\texttt{in}\brangle{1}\sim\texttt{in}\brangle{2}$ and all $i$: \begin{enumerate}
        \setcounter{enumi}{8}
        \item If $t_i$ is in a cycle, then $\gamma_i = -\texttt{in}\brangle{1}_i+\texttt{in}\brangle{2}_i$
        \item If $t_i$ is in a cycle, then $\gamma_i' = -\texttt{in}\brangle{1}_i+\texttt{in}\brangle{2}_i$
        \item If $t_i$ is in a cycle, then for all $j$, $\gamma_{(i, j)} = 0$ and $\gamma_{(j, i)} = 0$
        \item If $\gamma_{(at_x(i), at_y(i))} = -\min(\texttt{in}_{at_y(i)}\brangle{1}-\texttt{in}_{at_x(i)}\brangle{1}, 0)$, then $\texttt{in}_{at_y(i)}\brangle{1}\geq \texttt{in}_{at_x(i)}\brangle{1}$
        \item If $\gamma_{(at_x(i), at_y(i))} = -\max(0, \texttt{in}_{at_y(i)}\brangle{1}+ \gamma_{at_y(i)}^{(y)}-\texttt{in}_{at_x(i)}\brangle{1}-\gamma_{at_x(i)}^{(x)})$, then $\texttt{in}_{at_y(i)}\brangle{1}\leq \texttt{in}_{at_x(i)}\brangle{1}$
        \item If $\gamma_{(at_x(i), at_y(i))} = -\min(\texttt{in}_{at_x(i)}\brangle{1}-\texttt{in}_{at_y(i)}\brangle{1}, 0)$, then $\texttt{in}_{at_x(i)}\brangle{1}\geq \texttt{in}_{at_y(i)}\brangle{1}$
        \item If $\gamma_{(at_x(i), at_y(i))} = -\max(0, \texttt{in}_{at_x(i)}\brangle{1}+ \gamma_{at_x(i)}^{(x)}-\texttt{in}_{at_y(i)}\brangle{1}-\gamma_{at_y(i)}^{(y)})$, then $\texttt{in}_{at_x(i)}\brangle{1}\leq \texttt{in}_{at_y(i)}\brangle{1}$
    \end{enumerate}
    then we say that $C$ satisfies the privacy constraint system for $L$. 
\end{defn}


\begin{lemma}
    If a coupling strategy $C$ satisfies the privacy constraint system for a 2v-looping branch $L$, then $cost(C)<\infty$ and $L$ is $cost(C)\varepsilon$-differentially private. 
\end{lemma}

\begin{proof}
    Because $C$ satisfies the privacy constraint system, we know that $C$ is a valid coupling strategy by lemma~\ref{mvcouplinglemma}. It remains to show that $C$ has finite cost. We can separate $cost(C)$ into cost contributed from $\gamma^{(x)}$ and $\gamma^{(x)\prime}$, $\gamma^{(y)}$ and $\gamma^{(y)\prime}$, and cross-coupling cost. We will denote these costs $c_x, c_{x\prime}, c_y, c_{y\prime}$, and $c_{xy}$ such that $cost(C) = c_x + c_{x\prime}+c_y+c_{y\prime}+c_{xy}$.

    From lemma \ref{finiteCostConstraintLemma}, we know that $c_x + c_{x\prime}+c_y+c_{y\prime}$ is finite because of constraints (9) and (10). 

    Similarly, observe that by constraints (12) through (15), $|\gamma_{(i, j)}|\leq 2$ because $\gamma_{at_x(i)}^{(x)},\gamma_{at_y(i)}^{(y)}\in [-1, 1]$. Because of constraint (11), this means that $c_{xy}\leq 2m$, where $m$ is the total number of distinct assignment transitions in $L$, which is finite because $L$ is constructed from a finite transition alphabet. This completes the proof.
\end{proof}


\sky{ we can remove this section and just appeal directly to the graph}
\subsubsection{Couplings for GDiPA}

We introduce a two-variable analogue to DiPA, which allows us to reason about counterexamples more easily. 

\begin{defn}
    A GDiPA $A$ is an 8-tuple $(Q, \Sigma, \mathcal{C}, \Gamma, q_{init}, X, P, \delta)$ where
    \begin{itemize}
        \item $Q$ is a finite set of locations partitioned into input locations $Q_{in}$ and non-input locations $Q_{non}$. 
        \item $\Sigma = \RR$ is the input alphabet
        \item $\mathcal{C} = \mathcal{C}^{(2)}$ is a set of guard conditions
        \item $\Gamma$ is a finite output alphabet
        \item $q_{init}\in Q$ is the initial location
        \item $X = \{\texttt{x}, \texttt{y}, \texttt{insample}^{(x)}, \texttt{insample}^{(x)}\prime, \texttt{insample}^{(y)}, \texttt{insample}^{(y)}\prime\}$ is a set of variables
        \item $P: Q\to \QQ\times \QQ^{\geq 0}\times \QQ\times  \QQ^{\geq 0}$ is a parameter function that assigns sampling parameters for the Laplace distribution for each location
        \item $\delta:(Q\times \mathcal{C})\to (Q\times (\Gamma \cup \{\texttt{insample}^{(x)}, \texttt{insample}^{(x)}\prime, \texttt{insample}^{(y)}, \texttt{insample}^{(y)}\prime\})\times \{0, 1, 2\})$ is a partial transition function. 
    \end{itemize}
    In addition, $\delta$ must satisfy some additional conditions:
    \begin{itemize}
        \item \textbf{Determinism:} For any location $q\in Q$, if $\delta(q, c)$ and $\delta(q, c')$ are defined for distinct guards $c, c'$,  then $c$ and $c'$ must be logically disjoint events.

        \item \textbf{Output Distinction:} For any location $q\in Q$, if $\delta(q, c) = (q_1, o_1, b_1)$ and $\delta(q, c') = (q_2, o_2, b_2)$, for distinct guards $c, c'$, then $o_1\neq o_2$ and at least one of $o_1\in \Gamma$ and $o_2\in \Gamma$ is true.

        \item \textbf{Initialization:} The initial location $q_0$ has only one outgoing transition of the form $\delta(q_0, \texttt{true}) = (q_1, o, 1)$ and $q_1$ has only one outgoing transition of the form $\delta(q_1, \texttt{true}) = (q, o', 2)$.

        \item \textbf{Non-input transition:} From any $q\in Q_{non}$, if $\delta(q, c)$ is defined, then $c=\texttt{true}$.
    \end{itemize}
\end{defn}

Just as with DiPAs and Programs, we can equivalently define a GDiPA as regular language that can be described as a finite union of 2-variable looping branches over a valid 2v-transition alphabet $\Sigma_T$. 

Like the single variable case, whenever the privacy constraint system is not satisfiable for a 2v-program, we can identify at least one of four types of graph structures in the corresponding GDiPA.

\begin{lemma}
    If no coupling strategy for a 2v-looping branch $L$ satisfies the privacy constraint system, then there exists a leaking cycle, non-cancelling leaking pair, disclosing cycle, or privacy violating path in a variable in $L$.
\end{lemma}
\begin{proof}
    Suppose that we have some maximally satisfied coupling strategy $C$ for $L$. There must be some constraint that is violated by $C$. Note that if constraint (11) is violated, then there must be a leaking cycle in $L$ since we only allow cross-couplings between assignment transitions. 

    Thus, we can assume that constraint (11) is not violated. 

    By lemma \ref{ProgramCounterexampleLemma}, there must then be either a leaking cycle, leaking pair, disclosing cycle, or privacy violating path with respect to a single variable. 

    We will show that, if there only exist leaking pairs in $L$, then at least one leaking pair must be a non-cancelling leaking pair. 

    For the sake of contradiction, suppose that every leaking pair $\kappa, \kappa'$ in $L$ is a cancelling leaking pair. 

    By definition, this means that for every two transitions $t_i, t_j$ in $\kappa, \kappa'$, $at_x(i) = at_x(j)$ and $at_y(i) = at_y(j)$.

    Without loss of generality, we will assume that every non-$\texttt{true}$ transition in $\kappa$ must either have guard $\lguard[\texttt{x}]\land\gguard[\texttt{y}]$ or $\lguard[\texttt{x}]\lor\gguard[\texttt{y}]$. Thus, every non-$\texttt{true}$ transition in $\kappa'$ must either have guard $\gguard[\texttt{x}]\land\lguard[\texttt{y}]$ or $\gguard[\texttt{x}]\lor\lguard[\texttt{y}]$, respectively. 

    Let $t_i$ be an arbitrary non-$\texttt{true}$ transition in $\kappa$ and $t_j$ be an arbitrary non-$\texttt{true}$ transition in $\kappa'$.

    Consider the case where $c_i = \lguard[\texttt{x}]\land\gguard[\texttt{y}]$ and $c_j = \gguard[\texttt{x}]\land\lguard[\texttt{y}]$; the other case is symmetric.

    Observe that at least one of $\texttt{in}_{at_x(i)}\brangle{1}\leq \texttt{in}_{at_y(i)}\brangle{1}$ or $\texttt{in}_{at_y(i)}\brangle{1}\geq \texttt{in}_{at_y(i)}\brangle{1}$ must be true. Suppose that $\texttt{in}_{at_x(i)}\brangle{1}\leq \texttt{in}_{at_y(i)}\brangle{1}$. The case where $\texttt{in}_{at_y(i)}\brangle{1}\geq \texttt{in}_{at_y(i)}\brangle{1}$ is symmetric. 

    Then we can set $\gamma_{at_x(i)} = -1$, $\gamma_{at_y(i)}=1$, and $\gamma_{(at_x(i), at_y(i))} =  -\max(0, \texttt{in}_{at_x(i)}\brangle{1}+ \gamma_{at_x(i)}^{(x)}-\texttt{in}_{at_y(i)}\brangle{1}-\gamma_{at_y(i)}^{(y)})$. 
    
    Because there do not exist disclosing cycles, leaking cycles, or privacy violating paths in either variable, this cannot violate any further constraints. Thus, $C$ is not maximal, which is our contradiction, so $L$ must contain either a leaking cycle, disclosing cycle, privacy violating path, or non-cancelling leaking pair in at least one variable.
\end{proof}

We also extend the DiPA counterexample results to show that the presence of any these four graph structures in a GDiPA must lead to a violation of privacy, which allows us to conclude that, even with two variables, coupling proofs are complete for 2v-programs.

\begin{lemma}
    If there exists a leaking cycle, disclosing cycle, or privacy violating path in a single variable or a non-cancelling leaking pair in a single variable in a GDiPA $A$, then $A$ is not $dvarepsilon$-differentially private for any $d>0$. 
\end{lemma}

\begin{thm}
    A GDiPA $A$ is $d\varepsilon$-differentially private for some $d>0$ if and only if there exists a valid and finite cost coupling strategy for every looping branch of $A$. 
\end{thm}

\subsection{Beyond Two Variables}

It is straightforward to extend the definitions of 2v-transitions, paths, looping branches, etc. to more than two variables; it is additionally straightforward to extend results like lemma \ref{mvParallelCouplingsLemma} to apply more than two variables. However, it is not immediately clear how cross-couplings would be extended to additional variables;
one obvious possibility is to allow for cross-couplings between \textit{all} possible pairs, but the completeness result likely would not generalize in the same fashion. 

\section{Conclusion}
We have shown how to use coupling techniques to prove privacy for a class of SVT-like programs first defined in \cite{chadhaLinearTimeDecidability2021} and discovered that couplings additionally characterize this class. We additionally showed that this can be done tractably, and that couplings can help provide lower bounds on privacy costs of these algorithms. 

Future work most naturally would focus on extensions of the program model. For the model, potential areas include removing the requirement for output to be deterministic of a path through the automaton, which would allow for algorithms such as Report Noisy Max to be captured by the model. Similarly, the alphabet of the automaton could be expanded to incorporate more than comparisons between two real numbers. 
Such extensions would naturally also require extensions of the class of couplings we define here, which are limited to ``shifts''. 

Additionally, we believe that couplings should completely characterize GDiPAs as well as DiPAs; proving this requires showing that a lack of well-formedness in any single variable generates a counterexample to privacy. 
In this vein, we would like to explore using couplings to \textit{disprove} privacy; the fact that shift couplings completely characterize DiPAs hints at the possibility of ``anti-couplings'' to generate counterexamples.